{
  "name": "Puppet",
  "tagline": "Linux configuration management course assignments and documentations. Course by Tero Karvinen, Haaga-Helia Uni. of Applied Sciences late autumn 2016. ",
  "body": "### Test environment\r\n- Macbook Pro (early 2011) \r\n- Xubuntu 16.04 on VirtualBox (5.0.28 r111378) / Puppet version 3.8.5\r\n- Raspberry Pi 3 model B / Raspbian GNU/Linux 8 (jessie) / Puppet version 3.7.2\r\n- Raspberry Pi 1 model B+ / Raspbian GNU/Linux 8 (jessie) / Puppet version 3.7.2\r\n\r\n### Why\r\nThis is documentation for the Linux configuration management course by Tero Karvinen in Haaga-Helia University of Applied Sciences. \r\n\r\n### The Agent / Master Architecture\r\nAssingment was to control agent computer(s) over the network with Puppet. First I configured new hostnames to computers. \r\n```\r\nsudo hostnamectl set-hostname archvm\r\nsudoedit /etc/hosts\r\n```\r\nInside the file I added hostname archvm after jaakko-VirtualBox.\r\n```\r\n127.0.0.1       localhost\r\n127.0.1.1       jaakko-VirtualBox archvm\r\n```\r\nWith RasPis the file content differs. I used two agents and named them puppi & puppit.\r\n```\r\n127.0.0.1       localhost\r\n::1             localhost ip6-localhost ip6-loopback\r\nff02::1         ip6-allnodes\r\nff02::2         ip6-allrouters\r\n\r\n127.0.1.1       raspberrypi puppi\r\n```\r\n```\r\n127.0.0.1       localhost\r\n::1             localhost ip6-localhost ip6-loopback\r\nff02::1         ip6-allnodes\r\nff02::2         ip6-allrouters\r\n\r\n127.0.1.1       raspberrypi puppit\r\n```\r\nRestart of the avahi daemon is required.\r\n```\r\nsudo service avahi-daemon restart\r\n```\r\nNow I was able to ping between the computers using the new hostnames.\r\n```\r\npi@puppi:/etc/puppet $ ping -c 1 archvm.local\r\nPING archvm.local (10.0.1.15) 56(84) bytes of data.\r\n64 bytes from 10.0.1.15: icmp_seq=1 ttl=64 time=8.47 ms\r\n\r\n--- archvm.local ping statistics ---\r\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\r\nrtt min/avg/max/mdev = 8.473/8.473/8.473/0.000 ms\r\n```\r\n```\r\njaakko@archvm:/etc/puppet$ ping -c 1 puppi.local\r\nPING puppi.local (10.0.1.12) 56(84) bytes of data.\r\n64 bytes from 10.0.1.12: icmp_seq=1 ttl=64 time=13.4 ms\r\n\r\n--- puppi.local ping statistics ---\r\n1 packets transmitted, 1 received, 0% packet loss, \r\n```\r\n\r\n### Configuring Master\r\n```\r\nsudo apt-get update\r\nsudo apt-get install -y puppetmaster\r\n```\r\nTo create new certificates, the puppet process has to be stopped and default ssl directory needs to be removed. With sudo ls it is possible to check the contents of directory and sudo rm -r to destroy it. It is good to stop to think again before executing sudo rm -r in any conditions.\r\n```\r\nsudo service puppetmaster stop\r\nsudo ls /var/lib/puppet/ssl/\r\nsudo rm -r /var/lib/puppet/ssl/\r\n```\r\n\r\n```\r\nsudoedit /etc/puppet/puppet.conf\r\n```\r\nNew hostname is added into the puppet.conf file. This goes under the [master] section. \r\n```\r\ndns_alt_names = archvm.local\r\n```\r\nThen starting the puppet will generate new /var/lib/puppet/ssl/ directory with new certificate.\r\n```\r\nsudo service puppet start\r\n```\r\n\r\n### Configuring agent\r\n\r\n```\r\nsudo apt-get update\r\nsudo apt-get install -y puppet \r\n```\r\nAdd new [agent] section and set the master there inside the config file.\r\n```\r\nsudoedit /etc/puppet/puppet.conf\r\n```\r\n```\r\n[agent]\r\nserver = archvm.local\r\n```\r\n\r\n```\r\nsudo puppet agent --enable\r\nsudo service puppet restart\r\n```\r\n\r\n### Sign the Cert from master and test from agents\r\n\r\n```\r\nsudo puppet cert --sign puppi.pp.htv.fi\r\nsudo puppet cert --sign puppit.pp.htv.fi\r\n```\r\n\r\n```\r\nsudo puppet agent -t\r\n```\r\n\r\nI used helloworld module to test how agents are taking orders. Here are the results in printscreens.\r\nThis module can be found from repository of this page. \r\n\r\n![print1]\r\n(https://github.com/jaakkojokinen/puppet/blob/master/docs/images/prints.png?raw=true)\r\n\r\n![print1]\r\n(https://github.com/jaakkojokinen/puppet/blob/master/docs/images/prints2.png?raw=true)\r\n\r\n### Sources\r\n\r\nThis document is heavily based on 2012 post by Tero Karvinen http://terokarvinen.com/2012/puppetmaster-on-ubuntu-12-04\r\n\r\nhttps://docs.puppet.com/puppet/3.8/reference/config_file_main.html\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}